-- ============================================================
-- üß© Resumen del Esquema: Plataforma de Comercio Electr√≥nico + Gesti√≥n Administrativa
-- ============================================================
-- üåê Proyecto: TrebolDrinks ‚Äî Backend Operativo y Administrativo
-- üóìÔ∏è Versi√≥n: 1.0
-- üß± Motor: PostgreSQL

-- üì¶ M√≥dulos Principales:
-- 1Ô∏è‚É£  Autenticaci√≥n:
--     - users, employees, customers
--     - sesiones, verificaci√≥n, logs
-- 2Ô∏è‚É£  Permisos y Roles:
--     - roles, modules, actions
--     - asignaci√≥n din√°mica por rol
-- 3Ô∏è‚É£  Cat√°logo de Productos:
--     - parent_categories, categories, products, inventory
--     - rese√±as, visibilidad, control de stock
-- 4Ô∏è‚É£  Pedidos y Pagos:
--     - orders, payments, payment_methods, payment_status, payment_channels
--     - cupones, shipping, historial de estado
-- 5Ô∏è‚É£  Carrito de Compras:
--     - cart, cart_items
-- 6Ô∏è‚É£  Localizaci√≥n y Clientes:
--     - countries, departments, cities, identity_types
-- 7Ô∏è‚É£  Funciones Extra:
--     - m√≥dulos promocionales, sistema de tickets, rese√±as verificadas

-- üöÄ Caracter√≠sticas Clave:
--     ‚úÖ Auditor√≠a completa (created_at, updated_at, deleted_at, restored_at)
--     ‚úÖ Soporte multicanal (web, mobile)
--     ‚úÖ Validaciones e integridad de datos
--     ‚úÖ Arquitectura escalable y modular
--     ‚úÖ Documentaci√≥n mantenible

-- üîê Seguridad y Flexibilidad:
--     - Roles y permisos granulares
--     - Tokens √∫nicos por sesi√≥n
--     - Soft deletes
--     - M√©todos de pago integrados

-- ‚úçÔ∏è Autor: Jose Luis Trespalacios
-- üßë‚Äçüíº Rol: CTO y Arquitecto de Software
-- üè¢ Compa√±√≠a: BitLink Technology Partner, TrebolDrinks
-- üìÖ √öltima modificaci√≥n: 30/03/25
-- -- ============================================================================
-- üóÉÔ∏è ENTIDADES
-- ============================================================================
-- ================================================
-- üóÉÔ∏è Tabla: countries ‚Äî Cat√°logo de pa√≠ses
-- ================================================
-- üóÉÔ∏è Tabla: countries ‚Äî Cat√°logo de pa√≠ses
-- üìå Uso: Base geogr√°fica (pa√≠s ‚Üí depto ‚Üí ciudad)
-- üîó Relaci√≥n: departments.country_id
-- üìè Unicidad: name, iso_code | Orden ‚â• 0 | Activo/inactivo
-- üåê Campos: ISO (alfa-2), tel√©fono, idioma, bandera, orden
-- üîÑ Auditor√≠a: created_at, updated_at, deleted_at, restored_at
-- ‚úçÔ∏è Jose Luis Trespalacios | CTO | BitLink | üìÖ 30/03/25
CREATE TABLE countries (
    country_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    iso_code CHAR(2) NOT NULL UNIQUE, -- C√≥digo ISO alfa-2 (ej: 'US', 'MX')
    phone_code VARCHAR(10),           -- C√≥digo telef√≥nico internacional (ej: '+1', '+52')
    primary_language VARCHAR(100),    -- Idioma principal del pa√≠s (ej: 'Espa√±ol', 'Ingl√©s')
    flag_url TEXT,                    -- URL o path de la bandera del pa√≠s
    display_order INT DEFAULT 0 CHECK (display_order >= 0), -- orden en el frontend
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)), -- estado activo/inactivo
    deleted_at TIMESTAMP NULL,    -- borrado l√≥gico (soft delete)
    restored_at TIMESTAMP NULL,   -- restauraci√≥n de borrado l√≥gico
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
INSERT INTO countries (
    name, iso_code, phone_code, primary_language, flag_url,
    display_order, is_active, created_at, updated_at, deleted_at, restored_at
)
VALUES
-- üá®üá¥ Sede Principal
('Colombia', 'CO', '+57', 'Espa√±ol', 'https://flags.example.com/co.svg', 1, TRUE, NOW(), NOW(), NULL, NULL),
-- üåé LATAM estrat√©gica
('M√©xico', 'MX', '+52', 'Espa√±ol', 'https://flags.example.com/mx.svg', 2, TRUE, NOW(), NOW(), NULL, NULL),
('Chile', 'CL', '+56', 'Espa√±ol', 'https://flags.example.com/cl.svg', 3, TRUE, NOW(), NOW(), NULL, NULL),
('Ecuador', 'EC', '+593', 'Espa√±ol', 'https://flags.example.com/ec.svg', 4, TRUE, NOW(), NOW(), NULL, NULL),
('Per√∫', 'PE', '+51', 'Espa√±ol', 'https://flags.example.com/pe.svg', 5, TRUE, NOW(), NOW(), NULL, NULL),
('Argentina', 'AR', '+54', 'Espa√±ol', 'https://flags.example.com/ar.svg', 6, TRUE, NOW(), NOW(), NULL, NULL),
('Brasil', 'BR', '+55', 'Portugu√©s', 'https://flags.example.com/br.svg', 7, TRUE, NOW(), NOW(), NULL, NULL),
('Panam√°', 'PA', '+507', 'Espa√±ol', 'https://flags.example.com/pa.svg', 8, TRUE, NOW(), NOW(), NULL, NULL),
('Uruguay', 'UY', '+598', 'Espa√±ol', 'https://flags.example.com/uy.svg', 9, TRUE, NOW(), NOW(), NULL, NULL),
('Paraguay', 'PY', '+595', 'Espa√±ol', 'https://flags.example.com/py.svg', 10, TRUE, NOW(), NOW(), NULL, NULL),
('Costa Rica', 'CR', '+506', 'Espa√±ol', 'https://flags.example.com/cr.svg', 11, TRUE, NOW(), NOW(), NULL, NULL),
-- üá∫üá∏ Norteam√©rica clave
('Estados Unidos', 'US', '+1', 'Ingl√©s', 'https://flags.example.com/us.svg', 12, TRUE, NOW(), NOW(), NULL, NULL),
('Canad√°', 'CA', '+1', 'Ingl√©s / Franc√©s', 'https://flags.example.com/ca.svg', 13, TRUE, NOW(), NOW(), NULL, NULL),
-- üåç Europa Occidental
('Espa√±a', 'ES', '+34', 'Espa√±ol', 'https://flags.example.com/es.svg', 14, TRUE, NOW(), NOW(), NULL, NULL),
('Portugal', 'PT', '+351', 'Portugu√©s', 'https://flags.example.com/pt.svg', 15, TRUE, NOW(), NOW(), NULL, NULL),
-- üåç Europa Central
('Francia', 'FR', '+33', 'Franc√©s', 'https://flags.example.com/fr.svg', 16, TRUE, NOW(), NOW(), NULL, NULL),
('Alemania', 'DE', '+49', 'Alem√°n', 'https://flags.example.com/de.svg', 17, TRUE, NOW(), NOW(), NULL, NULL),
('Italia', 'IT', '+39', 'Italiano', 'https://flags.example.com/it.svg', 18, TRUE, NOW(), NOW(), NULL, NULL),
('Pa√≠ses Bajos', 'NL', '+31', 'Neerland√©s', 'https://flags.example.com/nl.svg', 19, TRUE, NOW(), NOW(), NULL, NULL),
('B√©lgica', 'BE', '+32', 'Neerland√©s / Franc√©s / Alem√°n', 'https://flags.example.com/be.svg', 20, TRUE, NOW(), NOW(), NULL, NULL),
-- üåç Europa N√≥rdica
('Suecia', 'SE', '+46', 'Sueco', 'https://flags.example.com/se.svg', 21, TRUE, NOW(), NOW(), NULL, NULL),
('Dinamarca', 'DK', '+45', 'Dan√©s', 'https://flags.example.com/dk.svg', 22, TRUE, NOW(), NOW(), NULL, NULL),
-- üåç Europa diversa con hubs log√≠sticos
('Suiza', 'CH', '+41', 'Alem√°n / Franc√©s / Italiano', 'https://flags.example.com/ch.svg', 23, TRUE, NOW(), NOW(), NULL, NULL),
('Reino Unido', 'GB', '+44', 'Ingl√©s', 'https://flags.example.com/gb.svg', 24, TRUE, NOW(), NOW(), NULL, NULL);
-- ================================================
-- üóÉÔ∏è Tabla: departments ‚Äî Cat√°logo de departamentos/regiones
-- ================================================
-- üóÉÔ∏è Tabla: departments ‚Äî Cat√°logo de departamentos/estados
-- üìå Uso: Subdivisi√≥n geogr√°fica por pa√≠s (pa√≠s ‚Üí depto)
-- üîó Relaci√≥n: countries.country_id (ON DELETE CASCADE)
-- üìè Unicidad: name | Orden ‚â• 0 | Activo/inactivo
-- üåê Campos: idioma, bandera, orden de visualizaci√≥n
-- üîÑ Auditor√≠a: created_at, updated_at, deleted_at, restored_at
-- ‚úçÔ∏è Jose Luis Trespalacios | CTO | BitLink | üìÖ 30/03/25
CREATE TABLE departments (
    department_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    country_id INTEGER NOT NULL REFERENCES countries(country_id) ON DELETE CASCADE,
    primary_language VARCHAR(100),  -- Idioma principal del departamento/estado
    flag_url TEXT,                  -- URL o path de la bandera del departamento
    display_order INTEGER DEFAULT 0 CHECK (display_order >= 0),
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP NULL,
    restored_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
-- ‚úçÔ∏è INSERT de datos
INSERT INTO departments (
    name,
    country_id,
    primary_language,
    flag_url,
    display_order,
    is_active,
    created_at,
    updated_at,
    deleted_at,
    restored_at
) VALUES
-- üá®üá¥ Colombia (country_id = 1)
('Cundinamarca', 1, 'Espa√±ol', 'https://flags.example.com/co-cundinamarca.svg', 1, TRUE, NOW(), NOW(), NULL, NULL),
('Antioquia', 1, 'Espa√±ol', 'https://flags.example.com/co-antioquia.svg', 2, TRUE, NOW(), NOW(), NULL, NULL),
('Valle del Cauca', 1, 'Espa√±ol', 'https://flags.example.com/co-valle.svg', 3, TRUE, NOW(), NOW(), NULL, NULL),
('Atl√°ntico', 1, 'Espa√±ol', 'https://flags.example.com/co-atlantico.svg', 4, TRUE, NOW(), NOW(), NULL, NULL),
('Bol√≠var', 1, 'Espa√±ol', 'https://flags.example.com/co-bolivar.svg', 5, TRUE, NOW(), NOW(), NULL, NULL),
('Santander', 1, 'Espa√±ol', 'https://flags.example.com/co-santander.svg', 6, TRUE, NOW(), NOW(), NULL, NULL),
-- üá≤üáΩ M√©xico (country_id = 2)
('Ciudad de M√©xico', 2, 'Espa√±ol', 'https://flags.example.com/mx-cdmx.svg', 1, TRUE, NOW(), NOW(), NULL, NULL),
('Jalisco', 2, 'Espa√±ol', 'https://flags.example.com/mx-jalisco.svg', 2, TRUE, NOW(), NOW(), NULL, NULL),
('Nuevo Le√≥n', 2, 'Espa√±ol', 'https://flags.example.com/mx-nuevoleon.svg', 3, TRUE, NOW(), NOW(), NULL, NULL),
('Estado de M√©xico', 2, 'Espa√±ol', 'https://flags.example.com/mx-edomex.svg', 4, TRUE, NOW(), NOW(), NULL, NULL),
('Quer√©taro', 2, 'Espa√±ol', 'https://flags.example.com/mx-queretaro.svg', 5, TRUE, NOW(), NOW(), NULL, NULL),
-- üá®üá± Chile (country_id = 3)
('Regi√≥n Metropolitana', 3, 'Espa√±ol', 'https://flags.example.com/cl-metropolitana.svg', 1, TRUE, NOW(), NOW(), NULL, NULL),
('Valpara√≠so', 3, 'Espa√±ol', 'https://flags.example.com/cl-valparaiso.svg', 2, TRUE, NOW(), NOW(), NULL, NULL),
('Biob√≠o', 3, 'Espa√±ol', 'https://flags.example.com/cl-biobio.svg', 3, TRUE, NOW(), NOW(), NULL, NULL),
-- üá™üá® Ecuador (country_id = 4)
('Pichincha', 4, 'Espa√±ol', 'https://flags.example.com/ec-pichincha.svg', 1, TRUE, NOW(), NOW(), NULL, NULL),
('Guayas', 4, 'Espa√±ol', 'https://flags.example.com/ec-guayas.svg', 2, TRUE, NOW(), NOW(), NULL, NULL),
('Azuay', 4, 'Espa√±ol', 'https://flags.example.com/ec-azuay.svg', 3, TRUE, NOW(), NOW(), NULL, NULL),
-- üáµüá™ Per√∫ (country_id = 5)
('Lima', 5, 'Espa√±ol', 'https://flags.example.com/pe-lima.svg', 1, TRUE, NOW(), NOW(), NULL, NULL),
('Arequipa', 5, 'Espa√±ol', 'https://flags.example.com/pe-arequipa.svg', 2, TRUE, NOW(), NOW(), NULL, NULL),
('La Libertad', 5, 'Espa√±ol', 'https://flags.example.com/pe-lalibertad.svg', 3, TRUE, NOW(), NOW(), NULL, NULL),
-- üá¶üá∑ Argentina (country_id = 6)
('Buenos Aires', 6, 'Espa√±ol', 'https://flags.example.com/ar-buenosaires.svg', 1, TRUE, NOW(), NOW(), NULL, NULL),
('Ciudad Aut√≥noma de Buenos Aires', 6, 'Espa√±ol', 'https://flags.example.com/ar-caba.svg', 2, TRUE, NOW(), NOW(), NULL, NULL),
('C√≥rdoba', 6, 'Espa√±ol', 'https://flags.example.com/ar-cordoba.svg', 3, TRUE, NOW(), NOW(), NULL, NULL),
('Santa Fe', 6, 'Espa√±ol', 'https://flags.example.com/ar-santafe.svg', 4, TRUE, NOW(), NOW(), NULL, NULL),
-- üáßüá∑ Brasil (country_id = 7)
('S√£o Paulo', 7, 'Portugu√©s', 'https://flags.example.com/br-saopaulo.svg', 1, TRUE, NOW(), NOW(), NULL, NULL),
('Rio de Janeiro', 7, 'Portugu√©s', 'https://flags.example.com/br-riodejaneiro.svg', 2, TRUE, NOW(), NOW(), NULL, NULL),
('Minas Gerais', 7, 'Portugu√©s', 'https://flags.example.com/br-minasgerais.svg', 3, TRUE, NOW(), NOW(), NULL, NULL),
('Paran√°', 7, 'Portugu√©s', 'https://flags.example.com/br-parana.svg', 4, TRUE, NOW(), NOW(), NULL, NULL),
-- üá∫üá∏ Estados Unidos (country_id = 8)
('Florida', 8, 'Ingl√©s', 'https://flags.example.com/us-florida.svg', 1, TRUE, NOW(), NOW(), NULL, NULL),
('Texas', 8, 'Ingl√©s', 'https://flags.example.com/us-texas.svg', 2, TRUE, NOW(), NOW(), NULL, NULL),
('California', 8, 'Ingl√©s', 'https://flags.example.com/us-california.svg', 3, TRUE, NOW(), NOW(), NULL, NULL),
('Nueva York', 8, 'Ingl√©s', 'https://flags.example.com/us-newyork.svg', 4, TRUE, NOW(), NOW(), NULL, NULL),
('Illinois', 8, 'Ingl√©s', 'https://flags.example.com/us-illinois.svg', 5, TRUE, NOW(), NOW(), NULL, NULL),
-- üá®üá¶ Canad√° (country_id = 9)
('Ontario', 9, 'Ingl√©s', 'https://flags.example.com/ca-ontario.svg', 1, TRUE, NOW(), NOW(), NULL, NULL),
('Quebec', 9, 'Franc√©s', 'https://flags.example.com/ca-quebec.svg', 2, TRUE, NOW(), NOW(), NULL, NULL),
('Columbia Brit√°nica', 9, 'Ingl√©s', 'https://flags.example.com/ca-britishcolumbia.svg', 3, TRUE, NOW(), NOW(), NULL, NULL),
-- üá™üá∏ Espa√±a (country_id = 10)
('Madrid', 10, 'Espa√±ol', 'https://flags.example.com/es-madrid.svg', 1, TRUE, NOW(), NOW(), NULL, NULL),
('Catalu√±a', 10, 'Catal√°n / Espa√±ol', 'https://flags.example.com/es-catalunya.svg', 2, TRUE, NOW(), NOW(), NULL, NULL),
('Andaluc√≠a', 10, 'Espa√±ol', 'https://flags.example.com/es-andalucia.svg', 3, TRUE, NOW(), NOW(), NULL, NULL),
('Valencia', 10, 'Valenciano / Espa√±ol', 'https://flags.example.com/es-valencia.svg', 4, TRUE, NOW(), NOW(), NULL, NULL),
-- üá´üá∑ Francia (country_id = 11)
('√éle-de-France', 11, 'Franc√©s', 'https://flags.example.com/fr-idf.svg', 1, TRUE, NOW(), NOW(), NULL, NULL),
('Auvernia-R√≥dano-Alpes', 11, 'Franc√©s', 'https://flags.example.com/fr-ara.svg', 2, TRUE, NOW(), NOW(), NULL, NULL),
('Occitania', 11, 'Franc√©s', 'https://flags.example.com/fr-occitania.svg', 3, TRUE, NOW(), NOW(), NULL, NULL),
-- üá©üá™ Alemania (country_id = 12)
('Baviera', 12, 'Alem√°n', 'https://flags.example.com/de-baviera.svg', 1, TRUE, NOW(), NOW(), NULL, NULL),
('Renania del Norte-Westfalia', 12, 'Alem√°n', 'https://flags.example.com/de-renania.svg', 2, TRUE, NOW(), NOW(), NULL, NULL),
('Berl√≠n', 12, 'Alem√°n', 'https://flags.example.com/de-berlin.svg', 3, TRUE, NOW(), NOW(), NULL, NULL);
-- ================================================
-- üóÉÔ∏è Tabla: cities ‚Äî Cat√°logo de ciudades o municipios
-- ================================================
-- üóÉÔ∏è Tabla: cities ‚Äî Cat√°logo de ciudades o municipios
-- üìå Uso: Tercer nivel geogr√°fico (pa√≠s ‚Üí depto ‚Üí ciudad)
-- üîó Relaci√≥n: departments.department_id (ON DELETE CASCADE)
-- üìè Unicidad: name | Orden ‚â• 0 | Activo/inactivo
-- üåê Campos: idioma, bandera, orden de visualizaci√≥n
-- üîÑ Auditor√≠a: created_at, updated_at, deleted_at, restored_at
-- ‚úçÔ∏è Jose Luis Trespalacios | CTO | BitLink | üìÖ 30/03/25
CREATE TABLE cities (
    city_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    department_id INTEGER NOT NULL REFERENCES departments(department_id) ON DELETE CASCADE,
    primary_language VARCHAR(100),  -- Idioma principal en la ciudad o municipio
    flag_url TEXT,                  -- URL o path de la bandera local (si aplica)
    display_order INTEGER NOT NULL DEFAULT 0 CHECK (display_order >= 0),
    is_active BOOLEAN NOT NULL DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP NULL,
    restored_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
-- ‚úçÔ∏è INSERT de datos
INSERT INTO cities (
    name,
    department_id,
    primary_language,
    flag_url,
    display_order,
    is_active,
    created_at,
    updated_at,
    deleted_at,
    restored_at
) VALUES
('Bogot√°', 1, 'Espa√±ol', 'https://flags.example.com/co-bogota.svg', 0, TRUE, NOW(), NOW(), NULL, NULL),
('Medell√≠n', 2, 'Espa√±ol', 'https://flags.example.com/co-medellin.svg', 1, TRUE, NOW(), NOW(), NULL, NULL),
('Envigado', 2, 'Espa√±ol', 'https://flags.example.com/co-envigado.svg', 2, TRUE, NOW(), NOW(), NULL, NULL),
('Itag√º√≠', 2, 'Espa√±ol', 'https://flags.example.com/co-itagui.svg', 3, TRUE, NOW(), NOW(), NULL, NULL),
('Cali', 3, 'Espa√±ol', 'https://flags.example.com/co-cali.svg', 4, TRUE, NOW(), NOW(), NULL, NULL),
('Palmira', 3, 'Espa√±ol', 'https://flags.example.com/co-palmira.svg', 5, TRUE, NOW(), NOW(), NULL, NULL),
('Barranquilla', 4, 'Espa√±ol', 'https://flags.example.com/co-barranquilla.svg', 6, TRUE, NOW(), NOW(), NULL, NULL),
('Soledad', 4, 'Espa√±ol', 'https://flags.example.com/co-soledad.svg', 7, TRUE, NOW(), NOW(), NULL, NULL),
('Cartagena', 5, 'Espa√±ol', 'https://flags.example.com/co-cartagena.svg', 8, TRUE, NOW(), NOW(), NULL, NULL),
('Turbaco', 5, 'Espa√±ol', 'https://flags.example.com/co-turbaco.svg', 9, TRUE, NOW(), NOW(), NULL, NULL),
('Bucaramanga', 6, 'Espa√±ol', 'https://flags.example.com/co-bucaramanga.svg', 10, TRUE, NOW(), NOW(), NULL, NULL),
('Floridablanca', 6, 'Espa√±ol', 'https://flags.example.com/co-floridablanca.svg', 11, TRUE, NOW(), NOW(), NULL, NULL),
('Pereira', 7, 'Espa√±ol', 'https://flags.example.com/co-pereira.svg', 12, TRUE, NOW(), NOW(), NULL, NULL),
('Dosquebradas', 7, 'Espa√±ol', 'https://flags.example.com/co-dosquebradas.svg', 13, TRUE, NOW(), NOW(), NULL, NULL),
('Manizales', 8, 'Espa√±ol', 'https://flags.example.com/co-manizales.svg', 14, TRUE, NOW(), NOW(), NULL, NULL),
('Villamar√≠a', 8, 'Espa√±ol', 'https://flags.example.com/co-villamaria.svg', 15, TRUE, NOW(), NOW(), NULL, NULL),
('C√∫cuta', 9, 'Espa√±ol', 'https://flags.example.com/co-cucuta.svg', 16, TRUE, NOW(), NOW(), NULL, NULL),
('Villa del Rosario', 9, 'Espa√±ol', 'https://flags.example.com/co-villadelrosario.svg', 17, TRUE, NOW(), NOW(), NULL, NULL),
('Santa Marta', 10, 'Espa√±ol', 'https://flags.example.com/co-santamarta.svg', 18, TRUE, NOW(), NOW(), NULL, NULL),
('Ci√©naga', 10, 'Espa√±ol', 'https://flags.example.com/co-cienaga.svg', 19, TRUE, NOW(), NOW(), NULL, NULL),
('Monterrey', 11, 'Espa√±ol', 'https://flags.example.com/mx-monterrey.svg', 20, TRUE, NOW(), NOW(), NULL, NULL),
('Guadalajara', 12, 'Espa√±ol', 'https://flags.example.com/mx-guadalajara.svg', 21, TRUE, NOW(), NOW(), NULL, NULL),
('Canc√∫n', 13, 'Espa√±ol', 'https://flags.example.com/mx-cancun.svg', 22, TRUE, NOW(), NOW(), NULL, NULL),
('Playa del Carmen', 13, 'Espa√±ol', 'https://flags.example.com/mx-playadelcarmen.svg', 23, TRUE, NOW(), NOW(), NULL, NULL),
('Santiago', 14, 'Espa√±ol', 'https://flags.example.com/cl-santiago.svg', 24, TRUE, NOW(), NOW(), NULL, NULL),
('Guayaquil', 15, 'Espa√±ol', 'https://flags.example.com/ec-guayaquil.svg', 25, TRUE, NOW(), NOW(), NULL, NULL),
('Quito', 16, 'Espa√±ol', 'https://flags.example.com/ec-quito.svg', 26, TRUE, NOW(), NOW(), NULL, NULL),
('Lima', 17, 'Espa√±ol', 'https://flags.example.com/pe-lima.svg', 27, TRUE, NOW(), NOW(), NULL, NULL),
('Arequipa', 18, 'Espa√±ol', 'https://flags.example.com/pe-arequipa.svg', 28, TRUE, NOW(), NOW(), NULL, NULL),
('S√£o Paulo', 19, 'Portugu√©s', 'https://flags.example.com/br-saopaulo.svg', 29, TRUE, NOW(), NOW(), NULL, NULL),
('Campinas', 19, 'Portugu√©s', 'https://flags.example.com/br-campinas.svg', 30, TRUE, NOW(), NOW(), NULL, NULL),
('Ciudad de Panam√°', 20, 'Espa√±ol', 'https://flags.example.com/pa-ciudad.svg', 31, TRUE, NOW(), NOW(), NULL, NULL),
('Buenos Aires', 21, 'Espa√±ol', 'https://flags.example.com/ar-buenosaires.svg', 32, TRUE, NOW(), NOW(), NULL, NULL),
('La Paz', 22, 'Espa√±ol', 'https://flags.example.com/bo-lapaz.svg', 33, TRUE, NOW(), NOW(), NULL, NULL),
('Asunci√≥n', 23, 'Espa√±ol', 'https://flags.example.com/py-asuncion.svg', 34, TRUE, NOW(), NOW(), NULL, NULL),
('Caracas', 24, 'Espa√±ol', 'https://flags.example.com/ve-caracas.svg', 35, TRUE, NOW(), NOW(), NULL, NULL),
('Montevideo', 25, 'Espa√±ol', 'https://flags.example.com/uy-montevideo.svg', 36, TRUE, NOW(), NOW(), NULL, NULL),
('San Jos√©', 26, 'Espa√±ol', 'https://flags.example.com/cr-sanjose.svg', 37, TRUE, NOW(), NOW(), NULL, NULL),
('Madrid', 27, 'Espa√±ol', 'https://flags.example.com/es-madrid.svg', 38, TRUE, NOW(), NOW(), NULL, NULL),
('Alcal√° de Henares', 27, 'Espa√±ol', 'https://flags.example.com/es-alcala.svg', 39, TRUE, NOW(), NOW(), NULL, NULL),
('Barcelona', 28, 'Catal√°n / Espa√±ol', 'https://flags.example.com/es-barcelona.svg', 40, TRUE, NOW(), NOW(), NULL, NULL),
('Lisboa', 29, 'Portugu√©s', 'https://flags.example.com/pt-lisboa.svg', 41, TRUE, NOW(), NOW(), NULL, NULL),
('Berl√≠n', 30, 'Alem√°n', 'https://flags.example.com/de-berlin.svg', 42, TRUE, NOW(), NOW(), NULL, NULL),
('Par√≠s', 31, 'Franc√©s', 'https://flags.example.com/fr-paris.svg', 43, TRUE, NOW(), NOW(), NULL, NULL),
('Mil√°n', 32, 'Italiano', 'https://flags.example.com/it-milan.svg', 44, TRUE, NOW(), NOW(), NULL, NULL),
('√Åmsterdam', 33, 'Neerland√©s', 'https://flags.example.com/nl-amsterdam.svg', 45, TRUE, NOW(), NOW(), NULL, NULL);
-- ================================================
-- üóÉÔ∏è Tabla: identity_types ‚Äî Tipos de documento de identidad
-- ================================================
-- üóÉÔ∏è Tabla: identity_types ‚Äî Tipos de documento de identidad
-- üìå Uso: Clasificaci√≥n de documentos (ej: DNI, pasaporte)
-- üìè Unicidad: name | Orden ‚â• 0 | Activo/inactivo
-- üåê Campos: nombre, descripci√≥n, orden de visualizaci√≥n
-- üîÑ Auditor√≠a: created_at, updated_at, deleted_at, restored_at
-- ‚úçÔ∏è Jose Luis Trespalacios | CTO | BitLink | üìÖ 30/03/25
CREATE TABLE identity_types (
    identity_type_id SMALLSERIAL PRIMARY KEY,
    name VARCHAR(50) NOT NULL UNIQUE,
    description VARCHAR(255),
    display_order INTEGER DEFAULT 0 CHECK (display_order >= 0),
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP NULL,
    restored_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
-- ‚úçÔ∏è INSERT de datos
INSERT INTO identity_types (name, description, display_order, is_active)
VALUES
-- üåç Documentos globales
('PASSPORT', 'Pasaporte internacional v√°lido para viajes', 1, TRUE),
-- üá®üá¥ Colombia
('CC', 'C√©dula de ciudadan√≠a para residentes colombianos', 2, TRUE),
('CE', 'C√©dula de extranjer√≠a para extranjeros en Colombia', 3, TRUE),
('TI', 'Tarjeta de identidad para menores de edad en Colombia', 4, TRUE),
('NIT', 'N√∫mero de identificaci√≥n tributaria (Colombia)', 5, TRUE),
('RUT', 'Registro √∫nico tributario para empresas (Colombia)', 6, TRUE),
-- üá≤üáΩ M√©xico
('CURP', 'Clave √önica de Registro de Poblaci√≥n (M√©xico)', 7, FALSE),
('RFC', 'Registro Federal de Contribuyentes (M√©xico)', 8, FALSE),
('IFE', 'Credencial del Instituto Nacional Electoral (M√©xico)', 9, FALSE),
-- üá®üá± Chile
('RUN', 'Rol √önico Nacional (Chile)', 10, FALSE),
('RUT_CL', 'Rol √önico Tributario (Chile)', 11, FALSE),
-- üá¶üá∑ Argentina
('DNI', 'Documento Nacional de Identidad (Argentina)', 12, FALSE),
('CUIL', 'C√≥digo √önico de Identificaci√≥n Laboral (Argentina)', 13, FALSE),
('CUIT', 'C√≥digo √önico de Identificaci√≥n Tributaria (Argentina)', 14, FALSE),
-- üá™üá∏ Espa√±a
('DNI_ES', 'Documento Nacional de Identidad (Espa√±a)', 15, FALSE),
('NIE', 'N√∫mero de Identificaci√≥n de Extranjero (Espa√±a)', 16, FALSE),
('CIF', 'C√≥digo de Identificaci√≥n Fiscal (Espa√±a)', 17, FALSE),
-- üáµüá™ Per√∫
('DNI_PE', 'Documento Nacional de Identidad (Per√∫)', 18, FALSE),
('RUC', 'Registro √önico de Contribuyentes (Per√∫)', 19, FALSE),
-- üá∫üá∏ Estados Unidos
('SSN', 'Social Security Number (EE.UU.)', 20, FALSE),
('ITIN', 'Individual Taxpayer Identification Number (EE.UU.)', 21, FALSE);
-- ================================================
-- üóÉÔ∏è Tabla: areas ‚Äî √Åreas organizacionales o funcionales
-- ================================================
-- üóÉÔ∏è Tabla: areas ‚Äî √Åreas organizacionales o funcionales
-- üìå Uso: Agrupaci√≥n de funciones o departamentos internos
-- üìè Unicidad: name | Activo/inactivo
-- üåê Campos: nombre, descripci√≥n
-- üîÑ Auditor√≠a: created_at, updated_at, deleted_at, restored_at
-- ‚úçÔ∏è Jose Luis Trespalacios | CTO | BitLink | üìÖ 30/03/25
CREATE TABLE areas (
    area_id SERIAL PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    description TEXT,
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP NULL,
    restored_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
-- ‚úçÔ∏è INSERT de datos
INSERT INTO areas (name, description) VALUES
('Administraci√≥n', '√Årea encargada de la gesti√≥n general de la empresa'),
('Log√≠stica', '√Årea que gestiona el almacenamiento y distribuci√≥n de productos'),
('Desarrollo', '√Årea t√©cnica de desarrollo de software y tecnolog√≠a'),
('Atenci√≥n al Cliente', '√Årea dedicada a soporte y relaci√≥n con clientes'),
('Marketing', '√Årea encargada de publicidad, marca y adquisici√≥n de usuarios'),
('Ventas', '√Årea responsable de los procesos comerciales y conversi√≥n');
-- ================================================
-- üóÉÔ∏è Tabla: positions ‚Äî Cargos o puestos laborales
-- ================================================
-- üóÉÔ∏è Tabla: positions ‚Äî Cargos o puestos laborales
-- üìå Uso: Definici√≥n de roles laborales dentro del √°rea o empresa
-- üìè Unicidad: name | Salario base ‚â• 0 | Activo/inactivo
-- üåê Campos: nombre, descripci√≥n, salario base
-- üîÑ Auditor√≠a: created_at, updated_at, deleted_at, restored_at
-- ‚úçÔ∏è Jose Luis Trespalacios | CTO | BitLink | üìÖ 30/03/25
CREATE TABLE positions (
    position_id SERIAL PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    description TEXT,
    base_salary NUMERIC(12, 2) CHECK (base_salary >= 0),
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP NULL,
    restored_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
-- ‚úçÔ∏è INSERT de datos
INSERT INTO positions (name, description, base_salary) VALUES
('Administrador General', 'Responsable de toda la operaci√≥n', 7000000),
('Gerente de Log√≠stica', 'Encargado de la operaci√≥n log√≠stica', 5000000),
('Desarrollador Backend', 'Encargado de sistemas y backend del ecommerce', 4500000),
('Agente de Soporte', 'Brinda atenci√≥n al cliente', 2200000),
('Dise√±ador UX/UI', 'Responsable de dise√±o e interfaz de usuario', 4000000),
('Especialista en Marketing Digital', 'Planifica y ejecuta campa√±as', 3500000),
('Ejecutivo de Ventas', 'Gestiona ventas y seguimiento a clientes', 3000000);
-- ===========================================================
-- üåê GESTI√ìN DE USUARIOS, ROLES Y PERMISOS PARA ECOMMERCE
-- üîÑ Relacionando: empleados, clientes y usuarios
-- üìÖ Versi√≥n optimizada y corregida: 30/03/2025
-- ===========================================================
-- ===========================================
-- 1. ROLES DEL SISTEMA
-- ===========================================
CREATE TABLE roles (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    slug VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    scope VARCHAR(50) NOT NULL CHECK (scope IN ('admin', 'frontend', 'both')) DEFAULT 'both',
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP DEFAULT NULL,
    restored_at TIMESTAMP DEFAULT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
INSERT INTO roles (name, slug, description, scope) VALUES
('Admin', 'admin', 'Acceso total al sistema', 'admin'),
('Supervisor', 'supervisor', 'Supervisa operaciones y gesti√≥n general', 'admin'),
('Vendedor', 'vendedor', 'Gesti√≥n de productos y pedidos', 'admin'),
('Inventarista', 'inventarista', 'Control de inventario y stock', 'admin'),
('Soporte', 'soporte', 'Atenci√≥n al cliente y gesti√≥n de tickets', 'admin'),
('Call Center', 'call-center', 'Atenci√≥n telef√≥nica a clientes', 'admin'),
('Marketing', 'marketing', 'Gesti√≥n de campa√±as y promociones', 'admin'),
('Dise√±ador', 'disenador', 'Gesti√≥n de interfaz visual y UX/UI', 'admin'),
('Auditor', 'auditor', 'Revisi√≥n y control de registros del sistema', 'admin'),
('Cliente', 'cliente', 'Acceso cliente desde frontend', 'frontend'),
('Invitado', 'invitado', 'Solo vista p√∫blica sin acceso autenticado', 'frontend');

-- ===========================================
-- 2. M√ìDULOS Y ACCIONES DEL SISTEMA
-- ===========================================
CREATE TABLE modules (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    slug VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    icon VARCHAR(100),
    group_name VARCHAR(100),
    show_in_menu BOOLEAN DEFAULT TRUE,
    is_public BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP DEFAULT NULL,
    restored_at TIMESTAMP DEFAULT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
INSERT INTO modules (
    name, slug, description, icon, group_name, show_in_menu, is_public, is_active, created_at, updated_at
) VALUES
('Dashboard', 'dashboard', 'Panel administrativo general', 'layout-dashboard', 'Administraci√≥n', TRUE, FALSE, TRUE, NOW(), NOW()),
('Configuraci√≥n', 'configuracion', 'Configuraci√≥n general del sistema', 'settings', 'Administraci√≥n', TRUE, FALSE, TRUE, NOW(), NOW()),
('Empleados', 'empleados', 'Gesti√≥n del personal interno', 'users', 'Administraci√≥n', TRUE, FALSE, TRUE, NOW(), NOW()),
('Roles y Permisos', 'roles-permisos', 'Gesti√≥n de roles y acciones del sistema', 'lock', 'Administraci√≥n', TRUE, FALSE, TRUE, NOW(), NOW()),
('√ìrdenes', 'ordenes', 'Gesti√≥n de pedidos de clientes', 'shopping-cart', 'Ventas', TRUE, FALSE, TRUE, NOW(), NOW()),
('Pagos', 'pagos', 'Control de transacciones y m√©todos de pago', 'credit-card', 'Ventas', TRUE, FALSE, TRUE, NOW(), NOW()),
('Cupones', 'cupones', 'Descuentos promocionales aplicables a √≥rdenes', 'ticket-percent', 'Ventas', TRUE, FALSE, TRUE, NOW(), NOW()),
('Clientes', 'clientes', 'Gesti√≥n de clientes registrados', 'user', 'Clientes', TRUE, FALSE, TRUE, NOW(), NOW()),
('Soporte al Cliente', 'soporte-cliente', 'Sistema de tickets y atenci√≥n', 'life-buoy', 'Clientes', TRUE, FALSE, TRUE, NOW(), NOW()),
('Productos', 'productos', 'Listado y edici√≥n de productos', 'box', 'Cat√°logo', TRUE, FALSE, TRUE, NOW(), NOW()),
('Inventario', 'inventario', 'Control de stock y disponibilidad', 'archive', 'Cat√°logo', TRUE, FALSE, TRUE, NOW(), NOW()),
('Categor√≠as', 'categorias', 'Gesti√≥n jer√°rquica de categor√≠as', 'tags', 'Cat√°logo', TRUE, FALSE, TRUE, NOW(), NOW()),
('Env√≠os', 'envios', 'Gesti√≥n de env√≠os y proveedores log√≠sticos', 'truck', 'Log√≠stica', TRUE, FALSE, TRUE, NOW(), NOW()),
('Tarifas de Env√≠o', 'tarifas-envio', 'Control de tarifas por peso/m√©todo', 'dollar-sign', 'Log√≠stica', TRUE, FALSE, TRUE, NOW(), NOW()),
('Promociones', 'promociones', 'Promociones visibles en el frontend', 'sparkles', 'Marketing', TRUE, FALSE, TRUE, NOW(), NOW()),
('Localizaci√≥n', 'localizacion', 'Gesti√≥n de pa√≠ses, departamentos y ciudades', 'globe', 'Geograf√≠a', TRUE, FALSE, TRUE, NOW(), NOW()),
('Tipos de Documento', 'tipos-documento', 'Tipos de identidad v√°lidos para clientes', 'id-card', 'Geograf√≠a', TRUE, FALSE, TRUE, NOW(), NOW()),
('Logs de Pagos', 'logs-pagos', 'Historial y trazabilidad de pagos', 'file-text', 'Auditor√≠a', TRUE, FALSE, TRUE, NOW(), NOW()),
('Historial de √ìrdenes', 'historial-ordenes', 'Cambios y trazabilidad de √≥rdenes', 'clock', 'Auditor√≠a', TRUE, FALSE, TRUE, NOW(), NOW()),
('Promociones Frontend', 'frontend-promociones', 'Promociones visibles en tienda', 'star', 'Frontend P√∫blico', FALSE, TRUE, TRUE, NOW(), NOW())
;

-- ===========================================
-- 3. USUARIOS DEL SISTEMA
-- ===========================================
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    is_verified BOOLEAN NOT NULL DEFAULT FALSE,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    last_login TIMESTAMP DEFAULT NULL,
    notes TEXT DEFAULT NULL,
    deleted_at TIMESTAMP DEFAULT NULL,
    restored_at TIMESTAMP DEFAULT NULL,
    created_by UUID REFERENCES users(id) ON DELETE SET NULL,
    updated_by UUID REFERENCES users(id) ON DELETE SET NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW()
);
-- ===========================================
-- 4. RELACI√ìN ROLES ‚Üî USUARIOS
-- ===========================================
CREATE TABLE user_roles (
    id SERIAL PRIMARY KEY,
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    role_id INT NOT NULL REFERENCES roles(id) ON DELETE CASCADE,
    deleted_at TIMESTAMP DEFAULT NULL,
    restored_at TIMESTAMP DEFAULT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
CREATE TABLE actions (
    id SERIAL PRIMARY KEY,
    module_id INT NOT NULL REFERENCES modules(id) ON DELETE CASCADE,
    name VARCHAR(100) NOT NULL,
    slug VARCHAR(100) NOT NULL,
    description TEXT,
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP NULL,
    restored_at TIMESTAMP NULL,
    created_by UUID REFERENCES users(id) ON DELETE SET NULL,
    updated_by UUID REFERENCES users(id) ON DELETE SET NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(module_id, slug)
);
INSERT INTO actions (module_id, name, slug, description, created_at, updated_at)
SELECT m.id, a.name, a.slug, a.description, NOW(), NOW()
FROM modules m
JOIN (
    -- Acciones comunes
    VALUES
        ('dashboard',        'Ver',     'view',     'Visualizar el panel general'),
        -- Configuraci√≥n del sistema
        ('configuracion',    'Ver',     'view',     'Ver configuraci√≥n general'),
        ('configuracion',    'Editar',  'update',   'Modificar par√°metros del sistema'),
        -- Empleados
        ('empleados',        'Ver',     'view',     'Ver listado de empleados'),
        ('empleados',        'Crear',   'create',   'Agregar nuevo empleado'),
        ('empleados',        'Editar',  'update',   'Actualizar datos del empleado'),
        ('empleados',        'Eliminar','delete',   'Eliminar o desactivar empleado'),
        -- Roles y permisos
        ('roles-permisos',   'Ver',     'view',     'Ver roles y permisos'),
        ('roles-permisos',   'Crear',   'create',   'Crear nuevos roles o acciones'),
        ('roles-permisos',   'Editar',  'update',   'Actualizar roles existentes'),
        ('roles-permisos',   'Eliminar','delete',   'Eliminar rol o permiso'),
        -- √ìrdenes
        ('ordenes',          'Ver',     'view',     'Ver √≥rdenes registradas'),
        ('ordenes',          'Editar',  'update',   'Actualizar estado de la orden'),
        ('ordenes',          'Cancelar','cancel',   'Cancelar orden de cliente'),
        -- Pagos
        ('pagos',            'Ver',     'view',     'Ver pagos y transacciones'),
        ('pagos',            'Reembolsar','refund', 'Gestionar devoluciones de dinero'),
        -- Cupones
        ('cupones',          'Ver',     'view',     'Ver cupones registrados'),
        ('cupones',          'Crear',   'create',   'Crear cupones de descuento'),
        ('cupones',          'Editar',  'update',   'Editar cupones existentes'),
        ('cupones',          'Eliminar','delete',   'Eliminar o desactivar cupones'),
        -- Clientes
        ('clientes',         'Ver',     'view',     'Ver clientes registrados'),
        ('clientes',         'Editar',  'update',   'Actualizar informaci√≥n del cliente'),
        -- Soporte
        ('soporte-cliente',  'Ver',     'view',     'Ver tickets de soporte'),
        ('soporte-cliente',  'Responder','reply',   'Responder solicitudes de clientes'),
        ('soporte-cliente',  'Cerrar',  'close',    'Cerrar ticket de soporte'),
        -- Productos
        ('productos',        'Ver',     'view',     'Ver productos disponibles'),
        ('productos',        'Crear',   'create',   'Registrar nuevos productos'),
        ('productos',        'Editar',  'update',   'Editar productos existentes'),
        ('productos',        'Eliminar','delete',   'Eliminar o desactivar productos'),
        -- Inventario
        ('inventario',       'Ver',     'view',     'Ver estado del inventario'),
        ('inventario',       'Actualizar','update', 'Actualizar stock de productos'),
        -- Categor√≠as
        ('categorias',       'Ver',     'view',     'Ver listado de categor√≠as'),
        ('categorias',       'Crear',   'create',   'Crear nueva categor√≠a'),
        ('categorias',       'Editar',  'update',   'Editar categor√≠a'),
        ('categorias',       'Eliminar','delete',   'Eliminar o desactivar categor√≠a'),
        -- Env√≠os
        ('envios',           'Ver',     'view',     'Ver env√≠os realizados'),
        ('envios',           'Actualizar','update', 'Actualizar estado del env√≠o'),
        ('envios',           'Asignar', 'assign',   'Asignar proveedor de env√≠o'),
        -- Tarifas de env√≠o
        ('tarifas-envio',    'Ver',     'view',     'Ver tarifas registradas'),
        ('tarifas-envio',    'Crear',   'create',   'Crear nuevas tarifas de env√≠o'),
        ('tarifas-envio',    'Editar',  'update',   'Editar tarifa existente'),
        ('tarifas-envio',    'Eliminar','delete',   'Eliminar o desactivar tarifa'),
        -- Promociones
        ('promociones',      'Ver',     'view',     'Ver promociones activas'),
        ('promociones',      'Crear',   'create',   'Crear promoci√≥n nueva'),
        ('promociones',      'Editar',  'update',   'Editar promoci√≥n'),
        ('promociones',      'Eliminar','delete',   'Eliminar promoci√≥n'),
        -- Localizaci√≥n
        ('localizacion',     'Ver',     'view',     'Ver pa√≠ses y ciudades'),
        ('localizacion',     'Editar',  'update',   'Actualizar datos geogr√°ficos'),
        -- Tipos de documento
        ('tipos-documento',  'Ver',     'view',     'Ver tipos de documento'),
        ('tipos-documento',  'Crear',   'create',   'Crear nuevo tipo'),
        ('tipos-documento',  'Editar',  'update',   'Actualizar tipo existente'),
        ('tipos-documento',  'Eliminar','delete',   'Eliminar tipo de documento'),
        -- Logs de pagos
        ('logs-pagos',       'Ver',     'view',     'Ver historial de logs de pago'),
        -- Historial de √≥rdenes
        ('historial-ordenes','Ver',     'view',     'Ver historial de cambios en √≥rdenes'),
        -- Frontend promociones
        ('frontend-promociones', 'Ver', 'view',     'Ver promociones p√∫blicas desde frontend')
) AS a(slug_modulo, name, slug, description)
ON m.slug = a.slug_modulo;
-- ===========================================
-- 5. EMPLEADOS (usuarios internos)
-- ===========================================
CREATE TABLE employees (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL UNIQUE REFERENCES users(id) ON DELETE CASCADE,
    employee_code VARCHAR(20) UNIQUE NOT NULL,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    email VARCHAR(150) UNIQUE NOT NULL,
    phone VARCHAR(20),
    gender VARCHAR(10) CHECK (gender IN ('male', 'female', 'other')),
    position_id INTEGER,
    area_id INTEGER,
    salary NUMERIC(12, 2) CHECK (salary >= 0),
    hire_date DATE,
    birth_date DATE,
    address TEXT,
    notes TEXT,
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP NULL,
    restored_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
-- ===========================================
-- 6. CLIENTES (usuarios frontend)
-- ===========================================
CREATE TABLE customers (
    customer_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL UNIQUE REFERENCES users(id) ON DELETE CASCADE,
    identity_type_id SMALLINT,
    identity_number VARCHAR(30) NOT NULL UNIQUE,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    phone VARCHAR(20),
    is_whatsapp BOOLEAN DEFAULT FALSE,
    email VARCHAR(100) NOT NULL UNIQUE,
    shipping_address VARCHAR(255),
    city_id INT,
    notes TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    deleted_at TIMESTAMP NULL,
    restored_at TIMESTAMP NULL,
    last_login TIMESTAMP,
    preferred_language VARCHAR(20) DEFAULT 'es',
    gender VARCHAR(10) CHECK (gender IN ('male', 'female', 'other')),
    date_of_birth DATE,
    updated_by UUID
);
-- ===========================================
-- 7. INSERT DE USUARIOS, EMPLEADOS Y CLIENTES
-- ===========================================
-- Usuarios (3 empleados + 3 clientes)
INSERT INTO users (id, name, email, password_hash, is_active, is_verified, created_at, updated_at)
VALUES
-- Empleados
('11111111-1111-1111-1111-111111111111', 'Juan P√©rez', 'juan@example.com', 'hash1', TRUE, TRUE, NOW(), NOW()),
('22222222-2222-2222-2222-222222222222', 'Carla Torres', 'carla@example.com', 'hash2', TRUE, TRUE, NOW(), NOW()),
('33333333-3333-3333-3333-333333333333', 'Luis Mart√≠nez', 'luis@example.com', 'hash3', TRUE, TRUE, NOW(), NOW()),
-- Clientes
('44444444-4444-4444-4444-444444444444', 'Ana G√≥mez', 'ana@example.com', 'hash4', TRUE, TRUE, NOW(), NOW()),
('55555555-5555-5555-5555-555555555555', 'Carlos L√≥pez', 'carlos@example.com', 'hash5', TRUE, TRUE, NOW(), NOW()),
('66666666-6666-6666-6666-666666666666', 'Laura Mart√≠nez', 'laura@example.com', 'hash6', TRUE, TRUE, NOW(), NOW());
-- Roles asignados
INSERT INTO user_roles (user_id, role_id)
VALUES
-- Empleados
('11111111-1111-1111-1111-111111111111', (SELECT id FROM roles WHERE slug = 'admin')),
('22222222-2222-2222-2222-222222222222', (SELECT id FROM roles WHERE slug = 'vendedor')),
('33333333-3333-3333-3333-333333333333', (SELECT id FROM roles WHERE slug = 'vendedor')),
-- Clientes
('44444444-4444-4444-4444-444444444444', (SELECT id FROM roles WHERE slug = 'cliente')),
('55555555-5555-5555-5555-555555555555', (SELECT id FROM roles WHERE slug = 'cliente')),
('66666666-6666-6666-6666-666666666666', (SELECT id FROM roles WHERE slug = 'cliente'));
-- Empleados
INSERT INTO employees (id, user_id, employee_code, first_name, last_name, email, phone, gender, hire_date, birth_date, address, notes)
VALUES
('aaaa1111-aaaa-aaaa-aaaa-aaaaaaaaaaaa', '11111111-1111-1111-1111-111111111111', 'EMP001', 'Juan', 'P√©rez', 'juan@example.com', '3012345678', 'male', '2020-01-01', '1985-06-15', 'Calle Falsa 123', 'Administrador principal'),
('aaaa2222-aaaa-aaaa-aaaa-aaaaaaaaaaaa', '22222222-2222-2222-2222-222222222222', 'EMP002', 'Carla', 'Torres', 'carla@example.com', '3104567890', 'female', '2021-06-01', '1987-07-20', 'Carrera 10 #20-30', 'Encargada log√≠stica'),
('aaaa3333-aaaa-aaaa-aaaa-aaaaaaaaaaaa', '33333333-3333-3333-3333-333333333333', 'EMP003', 'Luis', 'Mart√≠nez', 'luis@example.com', '3123456789', 'male', '2022-03-01', '1990-11-11', 'Av. Siempre Viva 742', 'Desarrollador backend');
-- Clientes
INSERT INTO customers (customer_id, user_id, identity_type_id, identity_number, first_name, last_name, email, phone, is_whatsapp, shipping_address, city_id, gender, date_of_birth)
VALUES
(gen_random_uuid(), '44444444-4444-4444-4444-444444444444', 1, 'CC123456', 'Ana', 'G√≥mez', 'ana@example.com', '3100001111', TRUE, 'Calle 1 #2-3', 1, 'female', '1990-01-01'),
(gen_random_uuid(), '55555555-5555-5555-5555-555555555555', 1, 'CC234567', 'Carlos', 'L√≥pez', 'carlos@example.com', '3200002222', FALSE, 'Carrera 4 #5-6', 1, 'male', '1985-05-05'),
(gen_random_uuid(), '66666666-6666-6666-6666-666666666666', 1, 'CC345678', 'Laura', 'Mart√≠nez', 'laura@example.com', '3000003333', TRUE, 'Transversal 8 #9-10', 1, 'female', '1993-08-08');
-- ================================================================
-- üè∑Ô∏è Tabla: parent_categories ‚Äî Categor√≠as principales del cat√°logo
-- ================================================================
-- üìå Prop√≥sito:
--     Representa las categor√≠as padre o principales del cat√°logo de productos,
--     permitiendo agrupar subcategor√≠as y facilitar la navegaci√≥n en el frontend.
-- üîó Relaciones:
--     - Puede relacionarse con subcategor√≠as a trav√©s de la tabla `categories` (via `parent_category_id`).
-- 
-- üìè Restricciones:
--     - `name`: obligatorio.
--     - `slug`: obligatorio y √∫nico, usado para URLs amigables.
--     - `display_order`: controla el orden de presentaci√≥n visual.
--     - `is_active`: habilita/deshabilita la visibilidad de la categor√≠a.
-- üîÑ Auditor√≠a:
--     - `created_at` / `updated_at`: control de cambios.
--     - `deleted_at`: soporte para borrado l√≥gico.
-- ‚úçÔ∏è Autor: Jose Luis Trespalacios | CTO | BitLink Technology Partner | üìÖ 30/03/25
CREATE TABLE parent_categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    slug VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    image_url VARCHAR(255) DEFAULT NULL,
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    display_order INT DEFAULT 0 CHECK (display_order >= 0),
    deleted_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
-- ====================================================================
-- üì• Insert: parent_categories ‚Äî Registro de categor√≠as principales
-- ====================================================================
-- üìå Prop√≥sito:
--     Inserta las categor√≠as ra√≠z del cat√°logo de productos que agrupan
--     subcategor√≠as espec√≠ficas. Estas categor√≠as son visibles en el frontend.
-- üè∑ Ejemplos:
--     - Cervezas, Licores fuertes, Snacks, Vinos, Cocteles, etc.
-- üîó Uso:
--     - Se conectan con `categories` mediante `parent_category_id`.
--     - Se utilizan en navegaci√≥n, filtros y agrupaci√≥n de productos.
-- ‚úçÔ∏è Autor: Jose Luis Trespalacios | Arquitecto de Software | Trebol Drinks
-- üìÖ √öltima modificaci√≥n: 30/03/25
INSERT INTO parent_categories (
    name,
    slug,
    description,
    image_url,
    is_active,
    display_order, -- Campo agregado
    created_at,
    updated_at,
    deleted_at
)
VALUES
('Cervezas', 'cervezas', 'Cervezas nacionales e internacionales.', 'https://treboldrinks.co/images/cervezas.jpg', TRUE, 1, NOW(), NOW(), NULL),
('Licores fuertes', 'licores-fuertes', 'Whisky, ron, tequila y m√°s.', 'https://treboldrinks.co/images/licores_fuerte.jpg', TRUE, 2, NOW(), NOW(), NULL),
('Licores de alta gama', 'licores-alta-gama', 'Ediciones limitadas y premium.', 'https://treboldrinks.co/images/licores_alta_gama.jpg', TRUE, 3, NOW(), NOW(), NULL),
('Snacks', 'snacks', 'Aperitivos y acompa√±amientos.', 'https://treboldrinks.co/images/snacks.jpg', TRUE, 4, NOW(), NOW(), NULL),
('Art√≠culos de licorera', 'articulos-licorera', 'Accesorios y herramientas para bebidas.', 'https://treboldrinks.co/images/articulos_licorera.jpg', TRUE, 5, NOW(), NOW(), NULL),
('Vinos y champagnes', 'vinos-champagnes', 'Vinos y espumantes.', 'https://treboldrinks.co/images/vinos_champagnes.jpg', TRUE, 6, NOW(), NOW(), NULL),
('Licores internacionales', 'licores-internacionales', 'Licores importados de todo el mundo.', 'https://treboldrinks.co/images/licores_internacionales.jpg', TRUE, 7, NOW(), NOW(), NULL),
('Aperitivos', 'aperitivos', 'Bebidas para iniciar una comida.', 'https://treboldrinks.co/images/aperitivos.jpg', TRUE, 8, NOW(), NOW(), NULL),
('Cocteles y mezcladores', 'cocteles-mezcladores', 'Bebidas listas para mezclar y disfrutar.', 'https://treboldrinks.co/images/cocteles.jpg', TRUE, 9, NOW(), NOW(), NULL),
('Bebidas sin alcohol', 'bebidas-sin-alcohol', 'Refrescos, jugos y m√°s opciones sin alcohol.', 'https://treboldrinks.co/images/bebidas_sin_alcohol.jpg', TRUE, 10, NOW(), NOW(), NULL),
('Licores artesanales', 'licores-artesanales', 'Bebidas destiladas artesanalmente.', 'https://treboldrinks.co/images/licores_artesanales.jpg', TRUE, 11, NOW(), NOW(), NULL);
-- ================================================
-- üóÉÔ∏è Tabla: categories ‚Äî Subcategor√≠as de productos
-- ================================================
-- üìå Prop√≥sito:
--     Define subcategor√≠as dentro del cat√°logo, vinculadas opcionalmente a categor√≠as padre.
-- üîó Relaciones:
--     - parent_category_id ‚Üí parent_categories.id
--     - Se asocia a: productos (products).
-- üìè Restricciones:
--     - slug: √≠ndice √∫nico externo.
--     - display_order: define orden en interfaces.
--     - is_active: control de visibilidad.
-- üîÑ Auditor√≠a:
--     - Campos est√°ndar: created_at, updated_at, deleted_at, restored_at.
-- ‚úçÔ∏è Autor: Jose Luis Trespalacios | Arquitecto de Software  
-- üìÖ √öltima modificaci√≥n: 30/03/25
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    parent_category_id INT NULL REFERENCES parent_categories(id) ON DELETE SET NULL,
    name VARCHAR(100) NOT NULL,
    slug VARCHAR(100) NOT NULL, -- Se quit√≥ UNIQUE aqu√≠
    description TEXT,
    image_url VARCHAR(255) DEFAULT NULL,
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    meta_title VARCHAR(255),
    meta_description TEXT,
    display_order INT DEFAULT 0 CHECK (display_order >= 0),
    deleted_at TIMESTAMP NULL,
    restored_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
-- üîê √çndice √∫nico para slugs
DROP INDEX IF EXISTS categories_slug;
CREATE UNIQUE INDEX IF NOT EXISTS categories_slug ON categories(slug);
-- ========================================================
-- üì• Inserci√≥n inicial ‚Äî Subcategor√≠as (categories)
-- ========================================================
-- üìå Descripci√≥n:
--     Registra las subcategor√≠as agrupadas bajo categor√≠as principales (ej. Cervezas, Licores).
-- üîó Dependencias:
--     - parent_category_id ‚Üí parent_categories.id
-- üß© Estructura:
--     - slug, meta_title y meta_description permiten SEO y navegaci√≥n clara.
--     - display_order define el orden en cat√°logos y men√∫s.
-- ‚úçÔ∏è Autor: Jose Luis Trespalacios | Arquitecto de Software  
-- üìÖ √öltima modificaci√≥n: 30/03/25
INSERT INTO categories (
    parent_category_id, 
    name, 
    slug, 
    description, 
    image_url, 
    is_active, 
    meta_title, 
    meta_description, 
    display_order, 
    created_at, 
    updated_at, 
    deleted_at
) VALUES
-- üåé Cervezas (ID 1)
(1, 'Cervezas nacionales', 'cervezas-nacionales', 'Cervezas de producci√≥n nacional.', 'https://treboldrinks.co/images/cervezas_nacionales.jpg', TRUE, 'Cervezas nacionales', 'Variedad de cervezas nacionales.', 1, NOW(), NOW(), NULL),
(1, 'Cervezas importadas', 'cervezas-importadas', 'Cervezas premium de distintas partes del mundo.', 'https://treboldrinks.co/images/cervezas_internacionales.jpg', TRUE, 'Cervezas importadas', 'Las mejores cervezas internacionales.', 2, NOW(), NOW(), NULL),
-- ü•É Licores fuertes (ID 2)
(2, 'Whisky', 'whisky', 'Variedad de whiskys premium.', 'https://treboldrinks.co/images/whisky.jpg', TRUE, 'Whisky', 'Whiskys de alta calidad.', 3, NOW(), NOW(), NULL),
(2, 'Ron', 'ron', 'Selecci√≥n de rones oscuros y blancos.', 'https://treboldrinks.co/images/ron.jpg', TRUE, 'Ron', 'Rones caribe√±os y premium.', 4, NOW(), NOW(), NULL),
(2, 'Tequila', 'tequila', 'Mejores tequilas para disfrutar.', 'https://treboldrinks.co/images/tequila.jpg', TRUE, 'Tequila', 'Tequilas de agave azul.', 5, NOW(), NOW(), NULL),
-- üç∑ Vinos y champagnes (ID 6)
(6, 'Vinos tintos', 'vinos-tintos', 'Los mejores vinos tintos.', 'https://treboldrinks.co/images/vinos_rojos.jpg', TRUE, 'Vinos tintos', 'Vinos perfectos para cenas.', 6, NOW(), NOW(), NULL),
(6, 'Vinos blancos', 'vinos-blancos', 'Vinos blancos frescos.', 'https://treboldrinks.co/images/vinos_blancos.jpg', TRUE, 'Vinos blancos', 'Vinos ideales para pescados.', 7, NOW(), NOW(), NULL),
-- üç∏ Cocteles y mezcladores (ID 9)
(9, 'Mixers y t√≥nicas', 'mixers-tonicas', 'Mixers para preparar tragos.', 'https://treboldrinks.co/images/mixers.jpg', TRUE, 'Mixers', 'Mixers para c√≥cteles y bebidas.', 8, NOW(), NOW(), NULL),
(9, 'Sangr√≠as y cocteles listos', 'sangrias-cocteles', 'Bebidas listas para servir.', 'https://treboldrinks.co/images/sangrias.jpg', TRUE, 'Sangr√≠as', 'Sangr√≠as y cocteles listos.', 9, NOW(), NOW(), NULL);

CREATE TABLE products (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- ID como UUID generado autom√°ticamente
    category_id INT NOT NULL REFERENCES categories(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL CHECK (char_length(name) > 0),
    slug VARCHAR(255) NOT NULL UNIQUE CHECK (char_length(slug) > 0),
    description TEXT,
    price NUMERIC(10,2) NOT NULL CHECK (price >= 0),
    stock INT DEFAULT 0 CHECK (stock >= 0),
    image_url VARCHAR(255) DEFAULT NULL,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    deleted_at TIMESTAMP DEFAULT NULL,
    restored_at TIMESTAMP DEFAULT NULL,
    created_by UUID DEFAULT NULL REFERENCES users(id) ON DELETE SET NULL,
    updated_by UUID DEFAULT NULL REFERENCES users(id) ON DELETE SET NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW()
);
INSERT INTO products 
(
    category_id, 
    name, 
    slug, 
    description, 
    price, 
    stock, 
    image_url, 
    is_active, 
    deleted_at, 
    restored_at, 
    created_by, 
    updated_by, 
    created_at, 
    updated_at
) VALUES
(
    1, 
    'Cerveza √Åguila', 
    'cerveza-aguila', 
    'Cerveza colombiana refrescante y ligera.', 
    5000, 
    100, 
    'https://treboldrinks.co/images/cerveza_aguila.jpg', 
    TRUE, 
    NULL, 
    NULL, 
    '11111111-1111-1111-1111-111111111111',  -- created_by: Juan P√©rez (admin)
    '11111111-1111-1111-1111-111111111111',  -- updated_by: Juan P√©rez (admin)
    NOW(), 
    NOW()
),
(
    1, 
    'Cerveza Club Colombia', 
    'cerveza-club-colombia', 
    'Cerveza premium con un sabor equilibrado y maltoso.', 
    7000, 
    80, 
    'https://treboldrinks.co/images/cerveza_club_colombia.jpg', 
    TRUE, 
    NULL, 
    NULL, 
    '11111111-1111-1111-1111-111111111111', 
    '11111111-1111-1111-1111-111111111111', 
    NOW(), 
    NOW()
),
(
    2, 
    'Cerveza Heineken', 
    'cerveza-heineken', 
    'Cerveza holandesa con un sabor suave y refrescante.', 
    8000, 
    90, 
    'https://treboldrinks.co/images/cerveza_heineken.jpg', 
    TRUE, 
    NULL, 
    NULL, 
    '11111111-1111-1111-1111-111111111111', 
    '11111111-1111-1111-1111-111111111111', 
    NOW(), 
    NOW()
),
(
    2, 
    'Cerveza Corona', 
    'cerveza-corona', 
    'Cerveza mexicana ligera y refrescante, ideal para el verano.', 
    8500, 
    75, 
    'https://treboldrinks.co/images/cerveza_corona.jpg', 
    TRUE, 
    NULL, 
    NULL, 
    '11111111-1111-1111-1111-111111111111', 
    '11111111-1111-1111-1111-111111111111', 
    NOW(), 
    NOW()
);
-- ===========================================
-- Tabla de estados de pago
-- ===========================================
-- Tabla de estados de pago
CREATE TABLE IF NOT EXISTS payment_status (
    id SERIAL PRIMARY KEY,
    status_name VARCHAR(255) NOT NULL,  
    status_key VARCHAR(50) NOT NULL UNIQUE,  
    description TEXT DEFAULT NULL,
    order_status_mapping VARCHAR(50) DEFAULT NULL,
    color VARCHAR(20) DEFAULT NULL,
    is_active BOOLEAN NOT NULL DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    
    deleted_at TIMESTAMP DEFAULT NULL,
    restored_at TIMESTAMP DEFAULT NULL,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NULL
);
INSERT INTO payment_status (
    status_name,
    status_key,
    description,
    order_status_mapping,
    color,
    is_active,
    created_at,
    updated_at
)
VALUES
('Pendiente', 'pending', 'El pago est√° pendiente de confirmaci√≥n.', 'waiting_payment', '#FFA500', TRUE, NOW(), NOW()),
('Completado', 'completed', 'El pago se ha realizado con √©xito.', 'order_completed', '#28A745', TRUE, NOW(), NOW()),
('Fallido', 'failed', 'El pago ha sido rechazado o ha fallado.', 'order_failed', '#DC3545', TRUE, NOW(), NOW()),
('Reembolsado', 'refunded', 'El pago ha sido reembolsado.', 'order_refunded', '#17A2B8', TRUE, NOW(), NOW()),
('Cancelado', 'canceled', 'El pago ha sido cancelado.', 'order_canceled', '#6C757D', TRUE, NOW(), NOW());
CREATE TABLE IF NOT EXISTS payment_methods (
    payment_method_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),        -- <== CORREGIDO
    name VARCHAR(255) NOT NULL,
    method_key VARCHAR(50) NOT NULL UNIQUE,
    place_holder VARCHAR(255),
    description TEXT,
    is_active BOOLEAN NOT NULL DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP DEFAULT NULL,
    restored_at TIMESTAMP DEFAULT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW()
);
INSERT INTO payment_methods (
    payment_method_id,            -- <== Ahora expl√≠cito (opcional, si quieres asignar un UUID)
    name,
    method_key,
    place_holder,
    description,
    is_active,
    deleted_at,
    restored_at,
    created_at,
    updated_at
)
VALUES
-- Tarjeta de Cr√©dito
(gen_random_uuid(), 'Tarjeta de Cr√©dito', 'credit_card', 'Ingresa los datos de tu tarjeta de cr√©dito.', 'Pago con tarjetas de cr√©dito.', TRUE, NULL, NULL, NOW(), NOW()),
-- Tarjeta de D√©bito
(gen_random_uuid(), 'Tarjeta de D√©bito', 'debit_card', 'Ingresa los datos de tu tarjeta de d√©bito.', 'Pago con tarjetas de d√©bito.', TRUE, NULL, NULL, NOW(), NOW()),
-- PSE
(gen_random_uuid(), 'PSE', 'pse', 'Selecciona tu banco para continuar.', 'Pago con PSE (banca en l√≠nea).', TRUE, NULL, NULL, NOW(), NOW()),
-- Nequi
(gen_random_uuid(), 'Nequi', 'nequi', 'Ingresa tu n√∫mero Nequi.', 'Pago con billetera Nequi.', TRUE, NULL, NULL, NOW(), NOW()),
-- Daviplata
(gen_random_uuid(), 'Daviplata', 'daviplata', 'Ingresa tu n√∫mero Daviplata.', 'Pago con billetera Daviplata.', TRUE, NULL, NULL, NOW(), NOW()),
-- Efectivo
(gen_random_uuid(), 'Efectivo', 'cash', 'Selecciona el punto de pago autorizado.', 'Pago en efectivo en puntos autorizados.', TRUE, NULL, NULL, NOW(), NOW()),
-- Transferencia Bancaria
(gen_random_uuid(), 'Transferencia Bancaria', 'bank_transfer', 'Sigue las instrucciones para la transferencia.', 'Transferencias bancarias directas.', TRUE, NULL, NULL, NOW(), NOW()),
-- PayPal
(gen_random_uuid(), 'PayPal', 'paypal', 'Ingresa los datos de tu cuenta PayPal.', 'Pago con cuenta PayPal.', TRUE, NULL, NULL, NOW(), NOW()),
-- Criptomonedas
(gen_random_uuid(), 'Criptomonedas', 'crypto', 'Escanea el c√≥digo QR para pagar.', 'Pago con Bitcoin, Ethereum y otras criptomonedas.', TRUE, NULL, NULL, NOW(), NOW());
CREATE TABLE IF NOT EXISTS payment_channels (
    payment_channel_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),   -- UUID como PK
    payment_method_id UUID NOT NULL REFERENCES payment_methods(payment_method_id) ON DELETE CASCADE, -- FK correcta
    name VARCHAR(100) NOT NULL,
    description TEXT DEFAULT NULL,
    is_active BOOLEAN NOT NULL DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP NULL,
    restored_at TIMESTAMP NULL,     -- ‚úÖ Campo agregado
    created_at TIMESTAMP DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMP DEFAULT NOW() NOT NULL
);
INSERT INTO payment_channels (
    payment_channel_id,
    payment_method_id,
    name,
    description,
    is_active,
    deleted_at,
    restored_at,      -- ‚úÖ Campo agregado en el INSERT
    created_at,
    updated_at
)
VALUES
-- Visa (para m√©todo de pago "credit_card")
(gen_random_uuid(),
(SELECT payment_method_id FROM payment_methods WHERE method_key = 'credit_card'),
'Visa',
'Pago con tarjeta de cr√©dito Visa.',
TRUE,
NULL,
NULL,    -- restored_at NULL al inicio
NOW(),
NOW()
),
-- Mastercard
(gen_random_uuid(),
(SELECT payment_method_id FROM payment_methods WHERE method_key = 'credit_card'),
'Mastercard',
'Pago con tarjeta de cr√©dito Mastercard.',
TRUE,
NULL,
NULL,
NOW(),
NOW()
),
-- American Express
(gen_random_uuid(),
(SELECT payment_method_id FROM payment_methods WHERE method_key = 'credit_card'),
'American Express',
'Pago con tarjeta de cr√©dito American Express.',
TRUE,
NULL,
NULL,
NOW(),
NOW()
),
-- Nequi
(gen_random_uuid(),
(SELECT payment_method_id FROM payment_methods WHERE method_key = 'nequi'),
'Nequi',
'Pago a trav√©s de la billetera digital Nequi.',
TRUE,
NULL,
NULL,
NOW(),
NOW()
),
-- Bitcoin
(gen_random_uuid(),
(SELECT payment_method_id FROM payment_methods WHERE method_key = 'crypto'),
'Bitcoin',
'Pago con Bitcoin.',
TRUE,
NULL,
NULL,
NOW(),
NOW()
),
-- PayPal
(gen_random_uuid(),
(SELECT payment_method_id FROM payment_methods WHERE method_key = 'paypal'),
'PayPal',
'Pago a trav√©s de PayPal.',
TRUE,
NULL,
NULL,
NOW(),
NOW()
);
CREATE TABLE IF NOT EXISTS payments (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    customer_id UUID NOT NULL 
        REFERENCES customers(customer_id) ON DELETE CASCADE,
    payment_method_id UUID NOT NULL 
        REFERENCES payment_methods(payment_method_id) ON DELETE CASCADE,
    payment_channel_id UUID NOT NULL 
        REFERENCES payment_channels(payment_channel_id) ON DELETE CASCADE,
    payment_status_id INT NOT NULL 
        REFERENCES payment_status(id) ON DELETE CASCADE,
    amount NUMERIC(12,2) NOT NULL CHECK (amount >= 0),
    currency VARCHAR(3) NOT NULL DEFAULT 'USD',
    transaction_reference VARCHAR(255) UNIQUE,
    payment_date TIMESTAMP DEFAULT NOW(),
    payment_method_details TEXT,
    is_successful BOOLEAN DEFAULT FALSE CHECK (is_successful IN (TRUE, FALSE)),
    failure_reason TEXT,
    order_id UUID NULL, -- Relaci√≥n futura (por ejemplo, a una tabla "orders")
    metadata JSONB, -- Para campos din√°micos como respuesta del gateway, IP, etc.
    deleted_at TIMESTAMP NULL,
    restored_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMP DEFAULT NOW() NOT NULL
);
-- Primero aseg√∫rate de que el canal PayPal exista
INSERT INTO payment_channels (
    payment_method_id, 
    name, 
    description, 
    is_active, 
    created_at, 
    updated_at
)
VALUES
(
    (SELECT payment_method_id FROM payment_methods WHERE method_key = 'paypal'),
    'PayPal',
    'Pago a trav√©s de PayPal.',
    TRUE,
    NOW(),
    NOW()
);
-- INSERT a payments con customer_id, order_id NULL y metadata JSONB
INSERT INTO payments (
    id,
    customer_id,
    payment_method_id,
    payment_channel_id,
    payment_status_id,
    amount,
    currency,
    transaction_reference,
    payment_date,
    payment_method_details,
    is_successful,
    failure_reason,
    order_id,
    metadata,
    deleted_at,
    restored_at,
    created_at,
    updated_at
)
VALUES
-- Pago exitoso con tarjeta Visa
(
    gen_random_uuid(),
    (SELECT customer_id FROM customers OFFSET 0 LIMIT 1),
    (SELECT payment_method_id FROM payment_methods WHERE method_key = 'credit_card' LIMIT 1),
    (SELECT payment_channel_id FROM payment_channels WHERE name = 'Visa' LIMIT 1),
    (SELECT id FROM payment_status WHERE status_key = 'completed' LIMIT 1),
    150.75,
    'USD',
    'TXN10001',
    NOW(),
    'Tarjeta terminada en 1234',
    TRUE,
    NULL,
    NULL,
    '{"ip":"192.168.1.1","device":"iPhone 14"}',
    NULL,
    NULL,
    NOW(),
    NOW()
),
-- Pago fallido con tarjeta Mastercard
(
    gen_random_uuid(),
    (SELECT customer_id FROM customers OFFSET 1 LIMIT 1),
    (SELECT payment_method_id FROM payment_methods WHERE method_key = 'debit_card' LIMIT 1),
    (SELECT payment_channel_id FROM payment_channels WHERE name = 'Mastercard' LIMIT 1),
    (SELECT id FROM payment_status WHERE status_key = 'pending' LIMIT 1),
    320.00,
    'EUR',
    'TXN10002',
    NOW(),
    'Tarjeta terminada en 5678',
    FALSE,
    'Fondos insuficientes',
    NULL,
    '{"ip":"10.0.0.22","geo_location":"Madrid, ES"}',
    NULL,
    NULL,
    NOW(),
    NOW()
),
-- Pago exitoso con PayPal
(
    gen_random_uuid(),
    (SELECT customer_id FROM customers OFFSET 2 LIMIT 1),
    (SELECT payment_method_id FROM payment_methods WHERE method_key = 'paypal' LIMIT 1),
    (SELECT payment_channel_id FROM payment_channels WHERE name = 'PayPal' LIMIT 1),
    (SELECT id FROM payment_status WHERE status_key = 'completed' LIMIT 1),
    89.99,
    'USD',
    'TXN10003',
    NOW(),
    'Cuenta PayPal asociada a juan@example.com',
    TRUE,
    NULL,
    NULL,
    '{"browser":"Chrome","transaction_gateway_id":"abc123"}',
    NULL,
    NULL,
    NOW(),
    NOW()
),
-- Pago fallido con Bitcoin
(
    gen_random_uuid(),
    (SELECT customer_id FROM customers OFFSET 0 LIMIT 1), -- ‚úÖ Reutiliza cliente 1
    (SELECT payment_method_id FROM payment_methods WHERE method_key = 'crypto' LIMIT 1),
    (SELECT payment_channel_id FROM payment_channels WHERE name = 'Bitcoin' LIMIT 1),
    (SELECT id FROM payment_status WHERE status_key = 'failed' LIMIT 1),
    500.00,
    'MXN',
    'TXN10004',
    NOW(),
    'Pago con wallet X',
    FALSE,
    'Error en confirmaci√≥n de red',
    NULL,
    '{"network_delay":"12s","attempts":3}',
    NULL,
    NULL,
    NOW(),
    NOW()
),
-- Pago devuelto por Nequi
(
    gen_random_uuid(),
    (SELECT customer_id FROM customers OFFSET 1 LIMIT 1), -- ‚úÖ Reutiliza cliente 2
    (SELECT payment_method_id FROM payment_methods WHERE method_key = 'nequi' LIMIT 1),
    (SELECT payment_channel_id FROM payment_channels WHERE name = 'Nequi' LIMIT 1),
    (SELECT id FROM payment_status WHERE status_key = 'refunded' LIMIT 1),
    45.50,
    'USD',
    'TXN10005',
    NOW(),
    'Cuenta Nequi 3001234567',
    TRUE,
    'Cliente solicit√≥ devoluci√≥n',
    NULL,
    '{"refund_type":"manual","requested_by":"user"}',
    NULL,
    NULL,
    NOW(),
    NOW()
);
CREATE TABLE shipping_methods (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP DEFAULT NULL,
    restored_at TIMESTAMP DEFAULT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
INSERT INTO shipping_methods (
    name,
    description,
    is_active,
    deleted_at,
    restored_at,
    created_at,
    updated_at
) VALUES 
('Est√°ndar', 'Entrega en 5-7 d√≠as h√°biles', TRUE, NULL, NULL, NOW(), NOW()),
('Express', 'Entrega en 1-3 d√≠as h√°biles', TRUE, NULL, NULL, NOW(), NOW()),
('D√≠a siguiente', 'Entrega al siguiente d√≠a h√°bil', TRUE, NULL, NULL, NOW(), NOW());
CREATE TABLE coupons (
    id SERIAL PRIMARY KEY,
    code VARCHAR(50) NOT NULL UNIQUE,
    discount_type VARCHAR(20) NOT NULL CHECK (discount_type IN ('percentage', 'fixed')),
    discount_value DECIMAL(10,2) NOT NULL CHECK (discount_value > 0),
    min_order_value DECIMAL(10,2) DEFAULT NULL CHECK (min_order_value >= 0),
    max_discount DECIMAL(10,2) DEFAULT NULL CHECK (max_discount >= 0),
    start_date DATE NOT NULL,
    expiration_date DATE NOT NULL CHECK (expiration_date > start_date),

    -- Nuevos campos sugeridos
    usage_limit INT DEFAULT NULL CHECK (usage_limit >= 0),
    times_used INT DEFAULT 0 CHECK (times_used >= 0),
    is_public BOOLEAN DEFAULT TRUE CHECK (is_public IN (TRUE, FALSE)),

    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP DEFAULT NULL,
    restored_at TIMESTAMP DEFAULT NULL,

    created_by UUID REFERENCES users(id) ON DELETE SET NULL,
    updated_by UUID REFERENCES users(id) ON DELETE SET NULL,

    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
INSERT INTO coupons (
    code, discount_type, discount_value, min_order_value, max_discount, 
    start_date, expiration_date,
    usage_limit, times_used, is_public,
    is_active, deleted_at, restored_at,
    created_by, updated_by, created_at, updated_at
)
VALUES
('SUMMER21', 'percentage', 15.00, 100.00, 30.00, '2021-06-01', '2021-09-30',
NULL, 0, TRUE,
TRUE, NULL, NULL,
'11111111-1111-1111-1111-111111111111', '11111111-1111-1111-1111-111111111111', NOW(), NOW()),
('BLACKFRIDAY', 'fixed', 50.00, 200.00, 50.00, '2021-11-01', '2021-11-30',
500, 23, TRUE,
TRUE, NULL, NULL,
'11111111-1111-1111-1111-111111111111', '11111111-1111-1111-1111-111111111111', NOW(), NOW()),
('WELCOME10', 'percentage', 10.00, 0.00, 0.00, '2022-01-01', '2022-12-31',
NULL, 10, TRUE,
TRUE, NULL, NULL,
'11111111-1111-1111-1111-111111111111', '11111111-1111-1111-1111-111111111111', NOW(), NOW());
-- ================================
-- üóÉÔ∏è Tabla: order_status
-- ================================
CREATE TABLE IF NOT EXISTS order_status (
    id SERIAL PRIMARY KEY,
    status_name VARCHAR(255) NOT NULL,
    status_key VARCHAR(50) UNIQUE NOT NULL,
    description TEXT DEFAULT NULL,
    -- Control de estado
    is_active BOOLEAN NOT NULL DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    -- Auditor√≠a
    created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    deleted_at TIMESTAMP WITHOUT TIME ZONE DEFAULT NULL,
    restored_at TIMESTAMP WITHOUT TIME ZONE DEFAULT NULL
);
-- ================================
-- üöÄ Inserts iniciales: order_status
-- ================================
INSERT INTO order_status (status_name, status_key, description, is_active)
VALUES
('Pendiente',    'pending',    'La orden ha sido creada.',                     TRUE),
('Procesando',   'processing', 'La orden est√° siendo procesada.',             TRUE),
('Enviada',      'shipped',    'La orden ha sido enviada al cliente.',        TRUE),
('Entregada',    'delivered',  'La orden ha sido entregada con √©xito.',       TRUE),
('Cancelada',    'cancelled',  'La orden fue cancelada por el cliente o el sistema.', TRUE),
('Devuelta',     'returned',   'El cliente devolvi√≥ uno o m√°s productos.',    TRUE),
('Reembolsada',  'refunded',   'Se realiz√≥ un reembolso al cliente.',         TRUE);
CREATE TABLE IF NOT EXISTS orders (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    customer_id UUID REFERENCES customers(customer_id) ON DELETE SET NULL,
    payment_id UUID REFERENCES payments(id) ON DELETE SET NULL,
    order_status_id INT NOT NULL DEFAULT 1 REFERENCES order_status(id) ON DELETE RESTRICT,
    order_date TIMESTAMP NOT NULL DEFAULT NOW(),
    shipping_address TEXT NULL,
    billing_address TEXT NULL,
    tracking_number VARCHAR(50) UNIQUE,
    notes TEXT NULL,
    total_amount NUMERIC(12, 2) NOT NULL DEFAULT 0 CHECK (total_amount >= 0),
    currency VARCHAR(3) NOT NULL DEFAULT 'USD',
    estimated_delivery_date DATE,
    shipping_method_id INT REFERENCES shipping_methods(id) ON DELETE SET NULL,
    coupon_id INT REFERENCES coupons(id) ON DELETE SET NULL,
    -- Auditor√≠a
    created_by UUID REFERENCES users(id) ON DELETE SET NULL,
    updated_by UUID REFERENCES users(id) ON DELETE SET NULL,
    -- Estado y control
    is_active BOOLEAN NOT NULL DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP NULL,
    restored_at TIMESTAMP NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW()
);
INSERT INTO orders (
    customer_id,
    payment_id,
    order_status_id,
    order_date,
    shipping_address,
    billing_address,
    tracking_number,
    notes,
    total_amount,
    currency,
    estimated_delivery_date,
    shipping_method_id,
    coupon_id,
    created_by,
    updated_by,
    is_active,
    created_at,
    updated_at
)
VALUES (
    -- Cliente activo
    (SELECT customer_id FROM customers WHERE is_active = TRUE LIMIT 1),
    -- Pago exitoso
    (SELECT id FROM payments WHERE is_successful = TRUE LIMIT 1),
    -- Estado "pendiente"
    (SELECT id FROM order_status WHERE status_key = 'pending' LIMIT 1),
    NOW(),
    -- Direcci√≥n de env√≠o y facturaci√≥n
    'Av. Siempre Viva 742, Springfield',
    'Calle Falsa 123, Springfield',
    -- Tracking
    'TRK987654321',
    -- Notas
    'El cliente pidi√≥ empaquetado especial.',
    -- Total y moneda
    159.75,
    'USD',
    -- Estimado de entrega (3 d√≠as despu√©s)
    NOW() + INTERVAL '3 days',
    -- M√©todo de env√≠o (Express por ejemplo)
    (SELECT id FROM shipping_methods WHERE name = 'Express' LIMIT 1),
    -- Cup√≥n aplicado (opcional, por ejemplo WELCOME10)
    (SELECT id FROM coupons WHERE code = 'WELCOME10' LIMIT 1),
    -- Auditor√≠a
    '11111111-1111-1111-1111-111111111111', -- created_by (admin Juan)
    '11111111-1111-1111-1111-111111111111', -- updated_by (admin Juan)
    TRUE,
    NOW(),
    NOW()
);
-- Relaci√≥n entre √ìrdenes y Cupones
CREATE TABLE order_coupons (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Cambi√© el tipo de ID a UUID
    order_id UUID NOT NULL REFERENCES orders(id) ON DELETE CASCADE,
    coupon_id INT NOT NULL REFERENCES coupons(id) ON DELETE CASCADE,
    discount_applied DECIMAL(10,2) NOT NULL CHECK (discount_applied >= 0),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    deleted_at TIMESTAMP NULL
);
CREATE TABLE IF NOT EXISTS order_products (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(), 
    -- Relaciones
    order_id UUID NOT NULL REFERENCES orders(id) ON DELETE CASCADE,
    product_id UUID NOT NULL REFERENCES products(id) ON DELETE CASCADE,
    -- Detalle de la compra
    quantity INT NOT NULL DEFAULT 1 CHECK (quantity > 0),
    unit_price DECIMAL(10,2) NOT NULL CHECK (unit_price >= 0),
    total_price DECIMAL(10,2) NOT NULL CHECK (total_price >= 0),
    -- Estado y auditor√≠a
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP NULL,
    restored_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMP DEFAULT NOW() NOT NULL
);
CREATE TABLE inventory (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    product_id UUID NOT NULL REFERENCES products(id) ON DELETE CASCADE, -- Cambiado a UUID
    stock INT DEFAULT 0 CHECK (stock >= 0),
    reserved_stock INT DEFAULT 0 CHECK (reserved_stock >= 0),
    available_stock INT GENERATED ALWAYS AS (stock - reserved_stock) STORED,
    warehouse_location VARCHAR(100) DEFAULT NULL,
    last_restocked_at TIMESTAMP DEFAULT NULL,
    restock_quantity INT DEFAULT 0 CHECK (restock_quantity >= 0),
    deleted_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    updated_by UUID DEFAULT NULL,
    CONSTRAINT check_stock_availability CHECK (stock >= reserved_stock)
);
CREATE TABLE reviews (
    uid UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    product_id UUID NOT NULL REFERENCES products(id) ON DELETE CASCADE,  -- ‚úÖ Cambiado a UUID
    customer_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    rating SMALLINT NOT NULL CHECK (rating BETWEEN 1 AND 5),
    review_text TEXT,
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),
    deleted_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
CREATE TABLE cart (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    customer_id UUID REFERENCES users(id) ON DELETE CASCADE, 
    session_id UUID NULL,  -- Permite carrito an√≥nimo antes de que el usuario inicie sesi√≥n
    total_amount NUMERIC(12, 2) DEFAULT 0, 
    status BOOLEAN DEFAULT TRUE,  -- TRUE = Activo, FALSE = Abandonado o Completado
    deleted_at TIMESTAMP NULL,  -- Fecha de eliminaci√≥n l√≥gica (NULL si sigue activo)
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
CREATE TABLE cart_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    cart_id UUID NOT NULL REFERENCES cart(id) ON DELETE CASCADE,
    product_id UUID NOT NULL REFERENCES products(id) ON DELETE CASCADE, -- Cambiado a UUID
    quantity INT NOT NULL CHECK (quantity > 0),
    unit_price NUMERIC(12, 2) NOT NULL,
    total_price NUMERIC(12, 2) GENERATED ALWAYS AS (quantity * unit_price) STORED,
    status BOOLEAN DEFAULT TRUE,
    deleted_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
CREATE TABLE shipping_providers (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    tracking_url VARCHAR(255) DEFAULT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
CREATE TABLE shipments (
    uid UUID PRIMARY KEY DEFAULT gen_random_uuid(),  -- Usar UID en lugar de ID
    order_id UUID NOT NULL REFERENCES orders(id) ON DELETE CASCADE,  -- Clave for√°nea a pedidos
    provider_id INT NOT NULL REFERENCES shipping_providers(id) ON DELETE CASCADE,  -- Clave for√°nea a proveedores de env√≠o
    tracking_number VARCHAR(50) NOT NULL UNIQUE,  -- N√∫mero de seguimiento del env√≠o
    estimated_delivery DATE NOT NULL,  -- Fecha estimada de entrega
    status VARCHAR(50) NOT NULL DEFAULT 'pending',  -- Estado del env√≠o (pendiente, enviado, entregado, etc.)
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),  -- Campo para gestionar si el env√≠o est√° activo o inactivo
    deleted_at TIMESTAMP NULL,  -- Campo para eliminar l√≥gicamente el env√≠o (soft delete)
    created_at TIMESTAMP DEFAULT NOW(),  -- Fecha de creaci√≥n
    updated_at TIMESTAMP DEFAULT NOW()  -- Fecha de √∫ltima actualizaci√≥n
);
CREATE TABLE shipping_rates (
    id SERIAL PRIMARY KEY,
    shipping_method_id INT NOT NULL REFERENCES shipping_methods(id) ON DELETE CASCADE,
    price DECIMAL(10,2) NOT NULL CHECK (price >= 0),
    weight_limit DECIMAL(10,2) CHECK (weight_limit > 0),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
CREATE TABLE order_shipping (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Cambi√© el tipo de ID a UUID
    order_id UUID NOT NULL REFERENCES orders(id) ON DELETE CASCADE, -- Referencia a la tabla de √≥rdenes
    shipping_method_id INT NOT NULL REFERENCES shipping_methods(id) ON DELETE CASCADE, -- Referencia a la tabla de m√©todos de env√≠o
    tracking_number VARCHAR(50) UNIQUE, -- N√∫mero de seguimiento del env√≠o
    estimated_delivery_date DATE, -- Fecha estimada de entrega
    shipping_address VARCHAR(255), -- Direcci√≥n de env√≠o
    shipping_cost DECIMAL(10,2) DEFAULT 0.00, -- Costo del env√≠o
    status VARCHAR(50) DEFAULT 'pending', -- Estado del env√≠o (pendiente, enviado, entregado, etc.)
    created_at TIMESTAMP DEFAULT NOW(), -- Fecha de creaci√≥n del registro
    updated_at TIMESTAMP DEFAULT NOW(), -- Fecha de √∫ltima actualizaci√≥n
    deleted_at TIMESTAMP NULL -- Eliminaci√≥n l√≥gica (NULL si sigue activo)
);
CREATE TABLE product_reviews (
    uid UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    product_id UUID NOT NULL REFERENCES products(id) ON DELETE CASCADE, -- Cambiado a UUID
    customer_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    rating SMALLINT NOT NULL CHECK (rating BETWEEN 1 AND 5),
    review TEXT,
    is_verified BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    deleted_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
CREATE TABLE customer_support_tickets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Cambio a UUID
    customer_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    subject VARCHAR(255) NOT NULL,
    message TEXT NOT NULL,
    status VARCHAR(50) DEFAULT 'open' CHECK (status IN ('open', 'closed', 'in_progress')),
    deleted_at TIMESTAMP NULL, -- Eliminaci√≥n l√≥gica (NULL si sigue activo)
    restored_at TIMESTAMP NULL, -- Fecha de restauraci√≥n (si se reactiva)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE order_history (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Cambi√© el tipo de ID a UUID
    order_id UUID NOT NULL REFERENCES orders(id) ON DELETE CASCADE,
    status VARCHAR(50) NOT NULL, -- Estado del pedido (ej. 'pending', 'shipped', 'delivered')
    change_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- Fecha y hora del cambio de estado
    reason TEXT, -- Motivo del cambio de estado (por ejemplo, 'Pago confirmado', 'Enviado', etc.)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- Fecha de creaci√≥n del registro
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- Fecha de √∫ltima actualizaci√≥n del registro
    deleted_at TIMESTAMP NULL -- Eliminaci√≥n l√≥gica (NULL si sigue activo)
);
CREATE TABLE payment_logs (
    id SERIAL PRIMARY KEY,  -- ID √∫nico para el log de pago
    payment_id UUID NOT NULL REFERENCES payments(id) ON DELETE CASCADE,  -- Referencia al pago relacionado
    status VARCHAR(50) NOT NULL,  -- Estado del pago registrado en el log
    log_details TEXT,  -- Detalles adicionales del log (pueden ser mensajes, errores, etc.)
    is_active BOOLEAN DEFAULT TRUE CHECK (is_active IN (TRUE, FALSE)),  -- Estado activo/inactivo del log
    deleted_at TIMESTAMP NULL,  -- Fecha de eliminaci√≥n l√≥gica (NULL si no se ha eliminado)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- Fecha de creaci√≥n del log
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP  -- Fecha de √∫ltima actualizaci√≥n
);
INSERT INTO shipping_rates (shipping_method_id, price, weight_limit) VALUES 
(1, 5.99, 10.0),
(2, 9.99, 10.0),
(3, 14.99, 10.0);